  const processSections = (layout: any) => {
    const sections = layout.sections?.map((section: any) => {
      // Calculate capacity safely
      let capacity = section.capacity || 0
      
      // Only try to calculate from rows if rows is actually an array
      if (!capacity && Array.isArray(section.rows)) {
        capacity = section.rows.reduce((total: number, row: any) => 
          total + (Array.isArray(row.seats) ? row.seats.length : 0), 0)
      }
      
      return {
        sectionId: section.id,
        sectionName: section.name,
        available: true,
        capacity: capacity,
        seatingType: formData.venue.seatingType === 'mixed' 
          ? section.type || 'reserved' 
          : formData.venue.seatingType
      }
    }) || []
    
    updateFormData('venue', { availableSections: sections })
  }
