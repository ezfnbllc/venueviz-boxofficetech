generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  role          UserRole  @default(CUSTOMER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  orders        Order[]
}

model Venue {
  id            String    @id @default(cuid())
  name          String
  address       String
  capacity      Int
  configuration Json
  sections      Section[]
  events        Event[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Section {
  id            String    @id @default(cuid())
  venueId       String
  venue         Venue     @relation(fields: [venueId], references: [id])
  name          String
  rows          Int
  seatsPerRow   Int
  seats         Seat[]
  createdAt     DateTime  @default(now())
}

model Seat {
  id            String    @id @default(cuid())
  sectionId     String
  section       Section   @relation(fields: [sectionId], references: [id])
  row           String
  number        String
  type          SeatType  @default(STANDARD)
  status        SeatStatus @default(AVAILABLE)
  tickets       Ticket[]
}

model Event {
  id            String    @id @default(cuid())
  venueId       String
  venue         Venue     @relation(fields: [venueId], references: [id])
  name          String
  description   String?
  dateTime      DateTime
  status        EventStatus @default(DRAFT)
  pricing       Json?
  orders        Order[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Order {
  id            String    @id @default(cuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  eventId       String
  event         Event     @relation(fields: [eventId], references: [id])
  tickets       Ticket[]
  total         Float
  status        OrderStatus @default(PENDING)
  paymentId     String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Ticket {
  id            String    @id @default(cuid())
  orderId       String
  order         Order     @relation(fields: [orderId], references: [id])
  seatId        String
  seat          Seat      @relation(fields: [seatId], references: [id])
  price         Float
  qrCode        String    @unique
  status        TicketStatus @default(ACTIVE)
}

enum UserRole {
  CUSTOMER
  STAFF
  ADMIN
  SUPER_ADMIN
}

enum SeatType {
  STANDARD
  VIP
  ACCESSIBLE
  PREMIUM
}

enum SeatStatus {
  AVAILABLE
  HELD
  SOLD
  MAINTENANCE
}

enum EventStatus {
  DRAFT
  PUBLISHED
  ONGOING
  COMPLETED
  CANCELLED
}

enum OrderStatus {
  PENDING
  PAID
  CANCELLED
  REFUNDED
}

enum TicketStatus {
  ACTIVE
  USED
  CANCELLED
}
